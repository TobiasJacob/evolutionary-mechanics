<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8"/>
    <title>Evolutionary mechanics</title>
    <script type="text/javascript">
      function draw() {
        // Paste output here
        const field = [[1, 1, 1, 1, 1, 1, 1, 1, 1, 1], [1, 1, 1, 1, 1, 1, 1, 1, 1, 1], [1, 1, 1, 1, 1, 1, 1, 1, 1, 1], [1, 1, 1, 1, 1, 1, 1, 1, 1, 1], [1, 1, 1, 1, 1, 1, 1, 1, 1, 1], [1, 1, 1, 1, 1, 1, 1, 1, 1, 1], [1, 1, 1, 1, 1, 1, 1, 1, 1, 1], [1, 1, 1, 1, 1, 1, 1, 1, 1, 1], [1, 1, 1, 1, 1, 1, 1, 1, 1, 1], [1, 1, 1, 1, 1, 1, 1, 1, 1, 1]];
        const u = [0, -4.54336e-05, -0.0113771, -0.0113445, 0.0116704, 0.0116495, -4.54426e-05, -0.0115709, 0.0240473, 0.0237593, -0.000430968, -0.012202, 0.0368111, 0.0361312, -0.00156725, -0.0133331, 0.049524, 0.0483328, -0.00382348, -0.0150246, 0.06153, 0.0596916, -0.00759842, -0.01726, 0.0717706, 0.069142, -0.013348, -0.0198445, 0.0784201, 0.0748945, -0.0215349, -0.0222395, 0.078113, 0.0736941, -0.0323778, -0.0236838, 0.0641821, 0.058401, -0.0448365, -0.0355402, 0.0382827, -0.0504695, -0.000407736, -0.0223983, -0.0220922, 0.0113639, -0.0219153, 0.023898, -0.021833, 0.0368144, -0.0217815, 0.0496672, -0.0216798, 0.0618194, -0.021424, 0.0722618, -0.020928, 0.0793619, -0.0204729, 0.0807388, -0.022923, 0.0756662, -0.0326199, 0.0664585, -0.00134746, -0.0334312, -0.0328297, 0.0106047, -0.0322588, 0.0232377, -0.0315549, 0.036157, -0.0305927, 0.0489715, -0.0293042, 0.061157, -0.0277387, 0.0719423, -0.0262518, 0.080294, -0.0260273, 0.0854406, -0.0290368, 0.087584, -0.0371525, 0.0884416, -0.00285225, -0.0449286, -0.0441157, 0.00944833, -0.0432737, 0.0221711, -0.0421662, 0.0350329, -0.0406684, 0.0477871, -0.0387909, 0.0601328, -0.0367763, 0.0716911, -0.0352834, 0.0821118, -0.0354653, 0.0912554, -0.0386952, 0.0993128, -0.0458326, 0.106817, -0.00471285, -0.0572432, -0.056358, 0.00805755, -0.0554125, 0.0208797, -0.0541543, 0.0336784, -0.052482, 0.0464186, -0.0504674, 0.0590855, -0.0484407, 0.0717177, -0.047081, 0.084451, -0.0474101, 0.0974794, -0.050565, 0.110785, -0.0571655, 0.123538, -0.00661336, -0.0705268, -0.0697241, 0.00664596, -0.0688538, 0.0195657, -0.0676993, 0.032312, -0.0661802, 0.0450743, -0.0643688, 0.0581187, -0.062551, 0.0718472, -0.061297, 0.0868113, -0.0615052, 0.103561, -0.0643332, 0.122072, -0.0707114, 0.140248, -0.00822246, -0.0846802, -0.084094, 0.0054287, -0.0834713, 0.0184269, -0.0826774, 0.0311342, -0.0816471, 0.0439191, -0.0804036, 0.057272, -0.0791039, 0.0719018, -0.0781169, 0.0887801, -0.0781623, 0.109018, -0.0805127, 0.13318, -0.0869189, 0.15863, -0.00928998, -0.0993458, -0.0990498, 0.00457635, -0.0988178, 0.0176425, -0.0986334, 0.030349, -0.0984674, 0.0431589, -0.0983066, 0.0567065, -0.0981661, 0.071929, -0.0981443, 0.0902098, -0.0986176, 0.113476, -0.100783, 0.143907, -0.107649, 0.180847, -0.00975104, -0.113968, -0.113929, 0.0041669, -0.114132, 0.0173398, -0.1147, 0.0301441, -0.115732, 0.0430696, -0.117299, 0.056805, -0.119416, 0.0724001, -0.122019, 0.0915375, -0.125053, 0.117034, -0.129137, 0.153899, -0.138619, 0.21057, -0.00981092, -0.128016, -0.128027, 0.00412613, -0.128399, 0.0174744, -0.129506, 0.0305604, -0.131702, 0.0438622, -0.135359, 0.0580687, -0.140888, 0.0742494, -0.148731, 0.0942013, -0.159381, 0.121325, -0.174048, 0.163888, -0.206705, 0.261247];
        const cornerIndexRow = [[0, 5, 9, 13, 17, 21, 25, 29, 33, 37, 0], [1, 4, 8, 12, 16, 20, 24, 28, 32, 36, 40], [42, 45, 47, 49, 51, 53, 55, 57, 59, 61, 63], [64, 67, 69, 71, 73, 75, 77, 79, 81, 83, 85], [86, 89, 91, 93, 95, 97, 99, 101, 103, 105, 107], [108, 111, 113, 115, 117, 119, 121, 123, 125, 127, 129], [130, 133, 135, 137, 139, 141, 143, 145, 147, 149, 151], [152, 155, 157, 159, 161, 163, 165, 167, 169, 171, 173], [174, 177, 179, 181, 183, 185, 187, 189, 191, 193, 195], [196, 199, 201, 203, 205, 207, 209, 211, 213, 215, 217], [218, 221, 223, 225, 227, 229, 231, 233, 235, 237, 239]];
        const cornerIndexCol = [[0, 6, 10, 14, 18, 22, 26, 30, 34, 38, 41], [2, 3, 7, 11, 15, 19, 23, 27, 31, 35, 39], [43, 44, 46, 48, 50, 52, 54, 56, 58, 60, 62], [65, 66, 68, 70, 72, 74, 76, 78, 80, 82, 84], [87, 88, 90, 92, 94, 96, 98, 100, 102, 104, 106], [109, 110, 112, 114, 116, 118, 120, 122, 124, 126, 128], [131, 132, 134, 136, 138, 140, 142, 144, 146, 148, 150], [153, 154, 156, 158, 160, 162, 164, 166, 168, 170, 172], [175, 176, 178, 180, 182, 184, 186, 188, 190, 192, 194], [197, 198, 200, 202, 204, 206, 208, 210, 212, 214, 216], [219, 220, 222, 224, 226, 228, 230, 232, 234, 236, 238]];
        const supports = {SupportRow1: { row: 0, col: 0}, SupportRow2: { row: 0, col: 10}, SupportCol: { row: 0, col: 0}}; 
        const forces = [{ attackCorner: { row: 10, col: 10}, forceRow: 10, forceCol:0}]
        const solutionSteps = 160;
        const residum = 1.54092e-07;
        const stress = [0.00160417, 0.00215497, 0.0206134, 0.0178472, 0.0936357, 0.055374, 0.29905, 0.130581, 0.774598, 0.273481, 1.73842, 0.532737, 3.46073, 0.971677, 5.95019, 1.60918, 7.59515, 2.57924, 15.4555, 78.2298, 0.0163419, 0.0126743, 0.0562938, 0.0522378, 0.123267, 0.117312, 0.230842, 0.213214, 0.381821, 0.341341, 0.529871, 0.480171, 0.526674, 0.592581, 0.266232, 1.04629, 1.7934, 8.83248, 8.79969, 38.7815, 0.0505101, 0.0250163, 0.07097, 0.0628443, 0.105944, 0.117294, 0.143363, 0.189888, 0.157143, 0.276498, 0.104869, 0.379528, 0.0120814, 0.668933, 0.356123, 2.43281, 1.89664, 8.68604, 4.69664, 22.0995, 0.0975163, 0.0365486, 0.0636582, 0.0495205, 0.0632392, 0.0726499, 0.0706341, 0.11293, 0.0711427, 0.189364, 0.0708292, 0.389355, 0.164388, 1.08654, 0.577541, 3.21449, 1.61993, 7.85423, 3.52311, 14.6327, 0.132436, 0.0465042, 0.0497058, 0.0346886, 0.0296539, 0.0325743, 0.0376243, 0.0515262, 0.0661716, 0.135309, 0.12485, 0.434284, 0.248844, 1.34279, 0.551309, 3.54512, 1.3564, 7.5168, 3.27923, 11.9354, 0.130976, 0.0538026, 0.0443106, 0.0392475, 0.0285773, 0.0341319, 0.0493305, 0.041946, 0.0957856, 0.105038, 0.158836, 0.380438, 0.241496, 1.28021, 0.442323, 3.57123, 1.14626, 7.91499, 3.2976, 12.528, 0.0927691, 0.0559943, 0.0501062, 0.0653899, 0.0567759, 0.0840035, 0.0905334, 0.0964006, 0.136906, 0.10871, 0.174681, 0.223793, 0.198888, 0.852665, 0.318382, 3.09455, 0.956294, 8.7949, 3.3182, 17.0738, 0.0434756, 0.0476464, 0.0543472, 0.0895426, 0.0841973, 0.152523, 0.126311, 0.211093, 0.167005, 0.222699, 0.180634, 0.162015, 0.154796, 0.244869, 0.194583, 1.716, 0.746894, 8.83831, 3.16113, 28.7884, 0.0108812, 0.0240456, 0.0400488, 0.0744635, 0.0756795, 0.173458, 0.115195, 0.328771, 0.149949, 0.518176, 0.159081, 0.632746, 0.119574, 0.455863, 0.0866392, 0.19258, 0.478745, 4.8878, 2.76902, 52.4934, 0.000258803, 0.000554307, 0.0151385, 0.0154791, 0.0431059, 0.0867595, 0.082593, 0.30037, 0.132295, 0.804201, 0.177489, 1.81456, 0.185329, 3.49809, 0.146222, 5.29532, 0.326193, 4.37434, 2.88385, 65.8173];
        
        // Paste output here
        var canvas = document.getElementById('tutorial');
        var ctx = canvas.getContext('2d');
        ctx.fillStyle = "white";
        ctx.fillRect(0, 0, canvas.width, canvas.height);

        const rows = field.length;
        const cols = field[0].length;
        const offsetX = 100;
        const offsetY = 100;
        
        const rectSize = 800 / Math.max(rows, cols);
        const movementScale = 1;

        function coordsToView(x, y) {
          return [offsetX + rectSize * x, offsetY + rectSize * y];
        }

        let stressI = 0;
        const stressScale = 255 / Math.max(...stress);
        ctx.strokeStyle = '#000';
        for (let r = 0; r < rows; r++) {
          for (let c = 0; c < cols; c++) {
            if (field[r][c]) {
              ctx.beginPath();
              ctx.moveTo(...coordsToView(r + movementScale * u[cornerIndexRow[r][c]], c + movementScale * u[cornerIndexCol[r][c]]));
              ctx.lineTo(...coordsToView((r + 1) + movementScale * u[cornerIndexRow[r + 1][c]], c + movementScale * u[cornerIndexCol[r + 1][c]]));
              ctx.lineTo(...coordsToView((r + 1) + movementScale * u[cornerIndexRow[r + 1][c + 1]], (c + 1) + movementScale * u[cornerIndexCol[r + 1][c + 1]]));
              ctx.lineTo(...coordsToView(r + movementScale * u[cornerIndexRow[r][c + 1]], (c + 1) + movementScale * u[cornerIndexCol[r][c + 1]]));
              ctx.closePath();
              ctx.stroke();

              ctx.fillStyle = 'rgb(255, ' + (255 - stress[stressI] * stressScale) + ', 255)';
              ctx.beginPath();
              ctx.moveTo(...coordsToView(r + movementScale * u[cornerIndexRow[r][c]], c + movementScale * u[cornerIndexCol[r][c]]));
              ctx.lineTo(...coordsToView((r + 1) + movementScale * u[cornerIndexRow[r + 1][c]], c + movementScale * u[cornerIndexCol[r + 1][c]]));
              ctx.lineTo(...coordsToView((r + 1) + movementScale * u[cornerIndexRow[r + 1][c + 1]], (c + 1) + movementScale * u[cornerIndexCol[r + 1][c + 1]]));
              ctx.closePath();
              ctx.fill();

              ctx.fillStyle = 'rgb(255, ' + (255 - stress[stressI + 1] * stressScale) + ', 255)';
              ctx.beginPath();
              ctx.moveTo(...coordsToView((r + 1) + movementScale * u[cornerIndexRow[r + 1][c + 1]], (c + 1) + movementScale * u[cornerIndexCol[r + 1][c + 1]]));
              ctx.lineTo(...coordsToView(r + movementScale * u[cornerIndexRow[r][c + 1]], (c + 1) + movementScale * u[cornerIndexCol[r][c + 1]]));
              ctx.lineTo(...coordsToView(r + movementScale * u[cornerIndexRow[r][c]], c + movementScale * u[cornerIndexCol[r][c]]));
              ctx.closePath();
              ctx.fill();

              stressI += 2;
            }
          }
        }

        ctx.strokeStyle = '#C00';
        const supportSize = 0.2;
        ctx.beginPath();
        ctx.moveTo(...coordsToView(supports.SupportRow1.row, supports.SupportRow1.col - supportSize));
        ctx.lineTo(...coordsToView(supports.SupportRow1.row, supports.SupportRow1.col + supportSize));
        ctx.closePath();
        ctx.stroke();
        ctx.beginPath();
        ctx.moveTo(...coordsToView(supports.SupportRow2.row, supports.SupportRow2.col - supportSize));
        ctx.lineTo(...coordsToView(supports.SupportRow2.row, supports.SupportRow2.col + supportSize));
        ctx.closePath();
        ctx.stroke();
        ctx.beginPath();
        ctx.moveTo(...coordsToView(supports.SupportCol.row - supportSize, supports.SupportCol.col));
        ctx.lineTo(...coordsToView(supports.SupportCol.row + supportSize, supports.SupportCol.col));
        ctx.closePath();
        ctx.stroke();

        function arrow(fromx, fromy, tox, toy) { // https://stackoverflow.com/questions/808826/draw-arrow-on-canvas-tag
          var headlen = 10; // length of head in pixels
          var dx = tox - fromx;
          var dy = toy - fromy;
          var angle = Math.atan2(dy, dx);
          ctx.moveTo(fromx, fromy);
          ctx.lineTo(tox, toy);
          ctx.lineTo(tox - headlen * Math.cos(angle - Math.PI / 6), toy - headlen * Math.sin(angle - Math.PI / 6));
          ctx.moveTo(tox, toy);
          ctx.lineTo(tox - headlen * Math.cos(angle + Math.PI / 6), toy - headlen * Math.sin(angle + Math.PI / 6));
        }

        ctx.strokeStyle = '#070';
        const forceSize = 6;
        for (let i = 0; i < forces.length; i++) {
          const force = forces[i];
          const r = force.attackCorner.row;
          const c = force.attackCorner.col;
          const [x, y] = coordsToView(r + movementScale * u[cornerIndexRow[r][c]], c + movementScale * u[cornerIndexCol[r][c]]);
          ctx.beginPath();
          arrow(x, y, x + force.forceRow * forceSize, y + force.forceCol * forceSize);
          ctx.closePath();
          ctx.stroke();
        }

        var statusP = document.getElementById('statusText');
        statusP.innerHTML = "Converged after " + solutionSteps + " with residum " + residum;
      }
    </script>
    <style type="text/css">
    </style>
  </head>
  <body onload="draw();">
    <canvas id="tutorial" width="1000" height="1000"></canvas>
    <p id="statusText">Converged after ...</p>
  </body>
</html>